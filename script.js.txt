document.addEventListener('DOMContentLoaded', () => {
    // Função para copiar texto
    function copyTextToClipboard(textToCopy) {
        // Tenta usar a API Clipboard (mais moderna)
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(textToCopy)
                .then(() => {
                    alert('Copiado para a área de transferência!');
                })
                .catch(err => {
                    console.error('Erro ao copiar com navigator.clipboard:', err);
                    fallbackCopyTextToClipboard(textToCopy); // Tenta método alternativo em caso de falha
                });
        } else {
            // Fallback para navegadores mais antigos ou em caso de permissão negada
            fallbackCopyTextToClipboard(textToCopy);
        }
    }

    // Função alternativa de cópia (usando textarea temporária)
    function fallbackCopyTextToClipboard(textToCopy) {
        const textarea = document.createElement('textarea');
        textarea.value = textToCopy;
        textarea.style.position = 'fixed'; // Evita scroll
        textarea.style.opacity = '0'; // Torna invisível
        document.body.appendChild(textarea);
        textarea.focus();
        textarea.select();
        try {
            const successful = document.execCommand('copy');
            const msg = successful ? 'Copiado para a área de transferência!' : 'Falha ao copiar. Tente selecionar o texto manualmente.';
            alert(msg);
        } catch (err) {
            console.error('Fallback: Oops, unable to copy', err);
            alert('Não foi possível copiar automaticamente. Por favor, selecione o texto e copie manualmente.');
        } finally {
            document.body.removeChild(textarea);
        }
    }

    // Adicionar listeners para botões de cópia individuais
    document.querySelectorAll('.copy-btn').forEach(button => {
        button.addEventListener('click', () => {
            const targetId = button.dataset.target;
            const inputElement = document.getElementById(targetId);
            if (inputElement) {
                copyTextToClipboard(inputElement.value);
            }
        });
    });

    // Adicionar listeners para botões de cópia de bloco
    document.querySelectorAll('.copy-block-btn').forEach(button => {
        button.addEventListener('click', () => {
            let blockText = button.dataset.block;
            // Decodificar %0A para quebras de linha reais
            blockText = decodeURIComponent(blockText.replace(/%0A/g, '\n'));
            copyTextToClipboard(blockText);
        });
    });

    // Adicionar funcionalidade para selecionar texto ao clicar nos inputs (melhora a UX)
    document.querySelectorAll('.copy-field input[type="text"]').forEach(input => {
        input.addEventListener('click', function() {
            this.select();
            // Para dispositivos móveis, tenta copiar automaticamente também no click
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(this.value)
                    .then(() => {
                        // Opcional: feedback sutil de cópia, mas o alerta do botão já cobre
                    })
                    .catch(err => {
                        console.warn('Click no input: Falha ao copiar, o usuário pode precisar copiar manualmente.', err);
                    });
            }
        });
    });
});
